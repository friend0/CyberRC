# CyberRC-CPP Client Library

The CPP client works with bindings to the Rust client.
This library depends on bindings generated by the rust build script that executes with `cargo build`.
This process is automated by the `CMakeLists.txt` file in this repo.

## Getting Started

The overall process for using this client is to first, get a new writer client.
The writer is the serial port connection manager to the CyberRC device.

Once you have a client, you can build messages, and use the writer to send them.

Example:

```
  // Initialize Writer instance - the serial port name my look different
  // depending on your system.
  Writer *writer = writer_new("/dev/tty.usbserial-B001JE6N", 115200);
  if (!writer) {
    printf("Failed to initialize Writer!\n");
    return 1;
  }

  // Construct a PPM message
  int32_t channels[] = {1000, 1500, 2000, 2500};
  PpmUpdateAllWrapper msg = {.line = 1,
                             .channel_values = channels, // Point to the array
                             .channel_values_count =
                                 sizeof(channels) / sizeof(channels[0])};
  // Encode the message
  size_t *out_len = 0;
  uint8_t *msg_enc = ppmupdate_encode(msg, out_len);

  // Write the message
  uint32_t result = writer_write(writer, CyberRCMessageTypeC::PpmUpdate,
                                 msg_enc, sizeof(msg_enc));
```

For a more comprehensive example, see `main.cpp` in the src directory.

## Building

1. Get a nix shell from the root of this repo with `nix develop`. Follow the instructions at the top level readme if you do not have nix installed.
2. Navigate to this directory, and run `cmake .`.
3. Run `make` to build the library.
